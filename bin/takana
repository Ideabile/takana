#!/usr/bin/env node

'use strict';

process.title = 'takana';

require("coffee-script");

var program   = require('commander'),
    helpers   = require('../lib/support/helpers'),
    fs        = require('fs'),
    Log4js    = require('log4js'),
    takana    = require('../index');

program
  .version('0.0.1')
  .option('-p, --path <path>', 'use a custom path instead of cwd')
  .option('-i, --includes <paths>', 'set include paths (comma separated)', function(val) { return val.split(','); })
  .parse(process.argv);

//
// Check params
//
var projectPath = program.path || process.cwd();
var includes    = program.includes || [];

if (!fs.existsSync(projectPath)){
  console.error("no such file or directory '%s'", projectPath);
  return;
}

if (!fs.statSync(projectPath).isDirectory()){
  console.error("'%s' is not a directory", projectPath);
  return;
}

projectPath = fs.realpathSync(helpers.sanitizePath(projectPath));

//
// Configure logging
//
Log4js.setGlobalLogLevel(Log4js.levels.INFO);
Log4js.configure({
    appenders: [
    {
      type: 'console',
      layout: {
        type: 'pattern',
        pattern: "%[[%r] [%p] - %]%m"
      }
    }
  ]
});


//
// Run takana
//
takana.run({
  path:         projectPath,
  includePaths: includes
});







